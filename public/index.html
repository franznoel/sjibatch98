<!DOCTYPE html>
<html ng-app="sji98">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJI Batch 98 | Login</title>
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <!--
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    -->

    <!-- AngularJs -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular-route.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular-resource.min.js"></script>
    <!-- Angular Material requires Angular.js Libraries -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
    <!-- Angular Material Library -->
    <script src="//ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
    <!-- Firebase -->
    <script src="//www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
    <script>
      var config = {
        apiKey: "AIzaSyC-H_ws7WPkLU9ax6Ge7SKFgh1pil4vCD8",
        authDomain: "sji.asteriainteractive.com",
        databaseURL: "//sjibatch98.firebaseio.com",
        storageBucket: "sjibatch98.appspot.com",
        messagingSenderId: "33808654629",
      };
      firebase.initializeApp(config);
    </script>
    <script src="https://cdn.firebase.com/libs/angularfire/2.3.0/angularfire.min.js"></script>
    <script>
    'use strict';
    angular.module('sji98',[
        'ngRoute',
        'ngMaterial',
        'FirebaseMembers'
      ]);

    angular.module('sji98').run(function (){
      console.log("Running 'sji98' module");
    });

    angular.module('sji98')
      .config(function($locationProvider,$routeProvider,$mdThemingProvider) {
          $mdThemingProvider.theme('default')
            .primaryPalette('blue');

          $locationProvider.html5Mode(true);

          $routeProvider
            .when('/',{
              templateUrl: 'templates/login.html'
            })
            .when('/members/add',{
              controller: 'Members',
              templateUrl: 'templates/members-add.html'
            })
            .when('/members/:id',{
              controller: 'Member',
              templateUrl: 'templates/members-id.html'
            })
            .when('/members',{
              controller: 'Members',
              templateUrl: 'templates/members.html'
            })
            .when('/accounts',{
              templateUrl: 'templates/accounts.html'
            })
            .otherwise('/404',{
              templateUrl: 'templates/404.html'
            });
      });

    angular.module('FirebaseMembers',[
        'firebase'
      ])
      .controller('Members',function($scope,$location,$firebaseArray,$firebaseObject) {
        var membersRef = firebase.database().ref().child('members');

        $scope.submit = function() {
          var members = $firebaseArray(membersRef);

          members.$add({
            name: this.user.name,
            email: this.user.email,
            birthdate: this.user.birthdate.getTime(),
            balance: this.user.balance
          }).then(function(ref) {
            // Add key to record
            var memberKey = ref.key;
            var member = members.$getRecord(memberKey);
            member.key = memberKey;
            members.$save(member).then(function(ref) {
              console.log("Sucessfully saved data " + ref.key);
            });
            members.$indexFor(memberKey);
          }).catch(function(errors) {
            console.log('Errors:' + errors);
          });
        };

        $scope.redirectTo = function() {
          $location.path('/members/'+this.member.key);
        };

        $scope.members = $firebaseArray(membersRef);

        var membersObject = $firebaseObject(membersRef);
        membersObject.$bindTo($scope,'members');
      })
      .controller('Member',function($scope,$location,$firebaseArray,$firebaseObject) {
        var membersRef = firebase.database().ref().child('members');
        var memberKey = $location.path().split('/')[2].toString();
        var members = $firebaseArray(membersRef);

        members.$loaded().then(function(ref) {
          $scope.member = members.$getRecord(memberKey);
          var memberIndex = members.$indexFor(memberKey);
        })

        $scope.members = $firebaseArray(membersRef);

        var membersObject = $firebaseObject(membersRef);
        membersObject.$bindTo($scope,'members');
      });

    </script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.3/angular-material.min.css" />
    <base href="/">
  </head>
  <body>
    <ng-view></ng-view>
  </body>
</html>